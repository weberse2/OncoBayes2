<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Critical quantile — critical_quantile • OncoBayes2</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Critical quantile — critical_quantile"><meta name="description" content="Calculates the critical value of a model covariate for
which a fixed quantile of the crude rate is equal to the
specified (tail or interval) probability. The specified
quantile can relate to the posterior or the predictive
distribution of the response rate."><meta property="og:description" content="Calculates the critical value of a model covariate for
which a fixed quantile of the crude rate is equal to the
specified (tail or interval) probability. The specified
quantile can relate to the posterior or the predictive
distribution of the response rate."><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">OncoBayes2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9-4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/introduction.html">Guiding Oncology Dose-Escalation Trials</a></li>
    <li><a class="dropdown-item" href="../articles/map_approach.html">Meta-Analytic-Predictive (MAP) approach for dose-toxicity modelling</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Novartis/OncoBayes2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Critical quantile</h1>
      <small class="dont-index">Source: <a href="https://github.com/Novartis/OncoBayes2/blob/main/R/critical_quantile.R" class="external-link"><code>R/critical_quantile.R</code></a></small>
      <div class="d-none name"><code>critical_quantile.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculates the critical value of a model covariate for
which a fixed quantile of the crude rate is equal to the
specified (tail or interval) probability. The specified
quantile can relate to the posterior or the predictive
distribution of the response rate.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">critical_quantile</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'blrmfit'</span></span>
<span><span class="fu">critical_quantile</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">newdata</span>,</span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">p</span>,</span>
<span>  <span class="va">qc</span>,</span>
<span>  <span class="va">lower.tail</span>,</span>
<span>  <span class="va">interval.x</span>,</span>
<span>  extendInt.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"auto"</span>, <span class="st">"no"</span>, <span class="st">"yes"</span>, <span class="st">"downX"</span>, <span class="st">"upX"</span><span class="op">)</span>,</span>
<span>  <span class="va">log.x</span>,</span>
<span>  predictive <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  maxiter <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'blrm_trial'</span></span>
<span><span class="fu">critical_quantile</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">newdata</span>,</span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">p</span>,</span>
<span>  <span class="va">qc</span>,</span>
<span>  <span class="va">lower.tail</span>,</span>
<span>  <span class="va">interval.x</span>,</span>
<span>  extendInt.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"auto"</span>, <span class="st">"no"</span>, <span class="st">"yes"</span>, <span class="st">"downX"</span>, <span class="st">"upX"</span><span class="op">)</span>,</span>
<span>  <span class="va">log.x</span>,</span>
<span>  predictive <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  maxiter <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>fitted model object</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>not used in this function</p></dd>


<dt id="arg-newdata">newdata<a class="anchor" aria-label="anchor" href="#arg-newdata"></a></dt>
<dd><p>optional data frame specifying for what to predict;
if missing, then the data of the input model <code>object</code> is
used</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>character giving the covariate name which is being search
for to meet the critical conditions.  This also supports 'tidy'
parameter selection by specifying <code>x = vars(...)</code>, where
<code>...</code>  is specified the same way as in
<code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">dplyr::select()</a></code> and similar
functions. Examples of using <code>x</code> in this way can be found
in the examples. For <code>blrm_trial</code> methods, it defaults to
the first entry in <code>summary(blrm_trial, "drug_info")$drug_name</code>.</p></dd>


<dt id="arg-p">p<a class="anchor" aria-label="anchor" href="#arg-p"></a></dt>
<dd><p>cumulative probability corresponding to the critical
quantile range.</p></dd>


<dt id="arg-qc">qc<a class="anchor" aria-label="anchor" href="#arg-qc"></a></dt>
<dd><p>if given as a sorted vector of length 2, then the two
entries define the interval on the response rate scale which
must correspond to the cumulative probability <code>p</code>. In this
case <code>lower.tail</code> must be <code>NULL</code> or left missing. If
<code>qc</code> is only a single number, then <code>lower.tail</code> must
be set to complete the specification of the tail area.</p></dd>


<dt id="arg-lower-tail">lower.tail<a class="anchor" aria-label="anchor" href="#arg-lower-tail"></a></dt>
<dd><p>defines if probabilities are lower or upper tail
areas. Must be defined if <code>qc</code> is a single number and must
not be defined if <code>qc</code> denotes an interval.</p></dd>


<dt id="arg-interval-x">interval.x<a class="anchor" aria-label="anchor" href="#arg-interval-x"></a></dt>
<dd><p>interval the covariate <code>x</code> is
searched. Defaults to the minimal and maximal value of <code>x</code>
in the data set used. Whenever <code>lower.tail</code> is set such
that it is known that a tail area is used, then the function
will automatically attempt to enlarge the search interval since
the direction of the inverted function is determined around the
critical value.</p></dd>


<dt id="arg-extendint-x">extendInt.x<a class="anchor" aria-label="anchor" href="#arg-extendint-x"></a></dt>
<dd><p>controls if the interval given in
<code>interval.x</code> should be extended during the root
finding. The default <code>"auto"</code> attempts to guess an
adequate setting in cases thats possible. Other possible values
are the same as for the <code>extendInt</code> argument of the
<code><a href="https://rdrr.io/r/stats/uniroot.html" class="external-link">stats::uniroot()</a></code> function.</p></dd>


<dt id="arg-log-x">log.x<a class="anchor" aria-label="anchor" href="#arg-log-x"></a></dt>
<dd><p>determines if during the numerical search for the
critical value the covariate space is logarithmized. By default
<code>x</code> is log transformed whenever all values are positive.</p></dd>


<dt id="arg-predictive">predictive<a class="anchor" aria-label="anchor" href="#arg-predictive"></a></dt>
<dd><p>logical indicates if the critical quantile
relates to the posterior (<code>FALSE</code>) or the predictive
(<code>TRUE</code>) distribution. Defaults to <code>FALSE</code>.</p></dd>


<dt id="arg-maxiter">maxiter<a class="anchor" aria-label="anchor" href="#arg-maxiter"></a></dt>
<dd><p>maximal number of iterations for root
finding. Defaults to <code>100</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Vector of length equal to the number of rows of the input
data set with the crticial value for the covariate specified as
<code>x</code> which fullfills the requirements as detailled
above. May return <code>NA</code> for cases where no solution is
found on the specified interval <code>interval.x</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function searches for a critical value \(x_c\) of the covariate
\(x\) (<code>x</code>) at which the integral over the model response in the
specified interval \(\pi_1\) to \(\pi_2\) (<code>qc</code>) is equal to the
given probability \(p\) (<code>p</code>). The given interval is considered
a tail area when <code>lower.tail</code> is used such that \(\pi_1 = 0\)
for <code>TRUE</code> and \(\pi_2=1\) for <code>FALSE</code>. At the
critical value \(x_c\) the equality holds</p>
<p>$$p = \int_{\pi_1}^{\pi_2} p(\pi | x_c) \, d\pi .$$</p>
<p>Note that a solution not guranteed to exist under all
circumstances. However, for a single agent model and when
requesting a tail probability then a solution does exist. In case
an interval probability is specified, then the solution may not
necessarily exist and the root finding is confined to the range
specified in <code>interval.x</code>.</p>
<p>In case the solution is requested for the predictive distribution
(<code>predictive=TRUE</code>), then the respective problem solved leads
to the equality of</p>
<p>$$p = \sum_{y= r_1 = \lceil n \, \pi_1 \rceil }^{r_2 = \lceil n \, \pi_2 \rceil } \int p(y|\pi, n) \, p(\pi | x_c) \, d\pi .$$</p>
<p>Furthermore, the covariate space is log transformed by default
whenever all values of the covariate \(x\) are positive in the data
set. Values of \(0\) are shifted into the positive domain by the
machine precision to avoid issues with an ill-defined \(\log(0)\).</p>
<p>For <code>blrm_trial</code> objects the default arguments for <code>p</code>,
<code>qc</code> and <code>lower.tail</code> are set to correspond to the
highest interval of <code>interval_prob</code> to be constrained by the
respective <code>interval_max_mass</code> (which are defined as part of
the <code>blrm_trial</code> objects). This will in the default case
correspond to the EWOC metric. These defaults are only applied if
<code>p</code>, <code>qc</code> and <code>lower.tail</code> are missing.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Setting up dummy sampling for fast execution of example</span></span></span>
<span class="r-in"><span><span class="co">## Please use 4 chains and 100x more warmup &amp; iter in practice</span></span></span>
<span class="r-in"><span><span class="va">.user_mc_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  OncoBayes2.MC.warmup <span class="op">=</span> <span class="fl">10</span>, OncoBayes2.MC.iter <span class="op">=</span> <span class="fl">20</span>, OncoBayes2.MC.chains <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  OncoBayes2.MC.save_warmup <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fit an example model. See documentation for "combo2" example</span></span></span>
<span class="r-in"><span><span class="fu"><a href="example_model.html">example_model</a></span><span class="op">(</span><span class="st">"combo2"</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>The largest R-hat is NA, indicating chains have not mixed.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Running the chains for more iterations may help. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#r-hat</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Running the chains for more iterations may help. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#bulk-ess</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Running the chains for more iterations may help. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#tail-ess</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Find dose of drug_A at which EWOC criterium is just fulfilled</span></span></span>
<span class="r-in"><span><span class="va">data_trial_ab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">codata_combo2</span>, <span class="va">group_id</span> <span class="op">==</span> <span class="st">"trial_AB"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">drug_A_crit</span> <span class="op">&lt;-</span> <span class="fu">critical_quantile</span><span class="op">(</span><span class="va">blrmfit</span>,</span></span>
<span class="r-in"><span>  newdata <span class="op">=</span> <span class="va">data_trial_ab</span>,</span></span>
<span class="r-in"><span>  x <span class="op">=</span> <span class="st">"drug_A"</span>, p <span class="op">=</span> <span class="fl">0.25</span>, qc <span class="op">=</span> <span class="fl">0.33</span>,</span></span>
<span class="r-in"><span>  lower.tail <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data_trial_ab</span><span class="op">$</span><span class="va">drug_A</span> <span class="op">&lt;-</span> <span class="va">drug_A_crit</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">blrmfit</span>, newdata <span class="op">=</span> <span class="va">data_trial_ab</span>, interval_prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.16</span>, <span class="fl">0.33</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        mean         sd       2.5%       50%     97.5% [0,0.16] (0.16,0.33]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 0.2784784 0.10046646 0.15311191 0.2942422 0.4260879      0.1         0.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.2575160 0.10161998 0.09526054 0.2553971 0.3886394      0.1         0.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 0.2784784 0.10046646 0.15311191 0.2942422 0.4260879      0.1         0.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 0.2784784 0.10046646 0.15311191 0.2942422 0.4260879      0.1         0.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 0.2575160 0.10161998 0.09526054 0.2553971 0.3886394      0.1         0.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 0.2769644 0.08214743 0.18177646 0.2522595 0.4188390      0.0         0.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7 0.2784784 0.10046646 0.15311191 0.2942422 0.4260879      0.1         0.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   (0.33,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1      0.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2      0.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3      0.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4      0.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5      0.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6      0.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7      0.3</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Recover user set sampling defaults</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="va">.user_mc_options</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sebastian Weber, Lukas A. Widmer, Andrew Bean.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

