<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Guiding Oncology Dose-Escalation Trials • OncoBayes2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Guiding Oncology Dose-Escalation Trials">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">OncoBayes2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9-4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction.html">Guiding Oncology Dose-Escalation Trials</a></li>
    <li><a class="dropdown-item" href="../articles/map_approach.html">Meta-Analytic-Predictive (MAP) approach for dose-toxicity modelling</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Novartis/OncoBayes2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Guiding Oncology Dose-Escalation Trials</h1>
                        <h4 data-toc-skip class="author">Andrew Bean,
Sebastian Weber, Lukas Widmer</h4>
            
            <h4 data-toc-skip class="date">2025-10-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Novartis/OncoBayes2/blob/main/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="d-none name"><code>introduction.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>OncoBayes2</code> package provides flexible functions for
Bayesian meta-analytic modeling of the incidence of Dose Limiting
Toxicities (DLTs) by dose level, under treatment regimes involving any
number of combination partners. Such models may be used to ensure
patient safety during trial conduct by supporting dose-escalation
decisions. In addition, the model can support estimation of the Maximum
Tolerated Dose (MTD) in adaptive Bayesian dose-escalation designs.</p>
<p>Whereas traditional dose escalation designs, such as the 3+3 design,
base the dosing decisions on predefined rules about the number of DLTs
in the last one or two cohorts at the current dose, model-based designs
such as those using Bayesian Logistic Regression Models (BLRMs) endeavor
to model the dose-toxicity relationship as a continuous curve, and allow
the model to guide dosing decisions. In this way, all available data
contributes to the dosing decisions. Furthermore, extensions to the BLRM
approach can support inclusion of available additional data on the
compound(s) involved. The additional data can be either historical data
collected prior trial conduct or concurrent data, which is collected
during trial conduct in the context of another trial/context.</p>
<p>The package supports incorporation of additional data through a
Meta-Analytic-Combined (MAC) framework [1]. Within the MAC model the
heterogeneous sources of data are assigned to <em>groups</em> and
information is shared across groups through a hierarchical model
structure. For any given group this leads to borrowing strength from all
other groups while discounting the information from other groups. The
amount of discounting (or down-weighting) is determined by the
heterogeneity. A group is commonly defined to be a trial, but that must
not necessarily hold.</p>
<p>The key assumption of the hierarchical model is the exchangability
assumption between the groups. There are two independent mechanisms in
the package which aim at relaxing the exchangability assumption:</p>
<ul>
<li><p>Differential discounting: Groups are assigned to different
strata. While the overall hierarchical mean stays the same, the
heterogeneity between groups is allowed to be different between strata.
Each group must be assigned to a single stratum only.</p></li>
<li><p>EXchangeable/Non-EXchangeable (EX/NEX) model for each group: With
EXNEX each group is modelled as being exchangeable with some probability
and is allowed to have it’s own group-specific estimate as if the group
is not exchangeable with the remainder of the data.</p></li>
</ul>
<p>Both techniques are rather advanced and are not discussed further in
this introduction.</p>
<p>In the following we illustrate first a very common use case of
historical information only and then consider concurrent data in
addition. In particular, we will discuss a trial evaluating a
combination of two drugs whenever historical information is available on
each drug individually from separate trials. This example will be
expanded by using in addition concurrent data on one of the drugs and on
their combination.</p>
<p><strong>Note on terminology:</strong> While in the literature (see
[1], [2], and [4]) the term <em>stratum</em> refers to a trial commonly,
<code>OncoBayes2</code> deviates here and uses the term <em>group</em>
instead. This is more in line with hierarchical modeling terminology.
The term <em>stratum</em> is used to define a higher level grouping
structure. That is, every group is assigned to a single <em>stratum</em>
within <code>OncoBayes2</code>. This higher level grouping (groups of
groups) is necessary whenever differential discounting is used. By
convention <code>OncoBayes2</code> assigns any group to the stratum
“all” whenever no stratum is assigned for a group.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Load involved packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://opensource.nibr.com/RBesT/" class="external-link">RBesT</a></span><span class="op">)</span>        <span class="co">## used to define priors</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://opensource.nibr.com/OncoBayes2/" class="external-link">OncoBayes2</a></span><span class="op">)</span>   <span class="co">## working horse</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>        <span class="co">## for mutate</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>        <span class="co">## defines expand_grid</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span>       <span class="co">## for tibbles</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>      <span class="co">## for plotting</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-use-case-dual-combination-trial-with-historical-information">Example use-case: Dual combination trial with historical
information<a class="anchor" aria-label="anchor" href="#example-use-case-dual-combination-trial-with-historical-information"></a>
</h2>
<p>Consider the application described in Section 3.2 of [1], in which
the risk of DLT is to be studied as a function of dose for two drugs,
drug A and drug B. Historical information on the toxicity profiles of
these two drugs is available from single agent trials
<code>trial_A</code> and <code>trial_B</code>. The historical data for
this example is available in an internal data set.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">kable</span><span class="op">(</span><span class="va">hist_combo2</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">group_id</th>
<th align="right">drug_A</th>
<th align="right">drug_B</th>
<th align="right">num_patients</th>
<th align="right">num_toxicities</th>
<th align="right">cohort_time</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">trial_A</td>
<td align="right">3.0</td>
<td align="right">0.0</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">trial_A</td>
<td align="right">4.5</td>
<td align="right">0.0</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">trial_A</td>
<td align="right">6.0</td>
<td align="right">0.0</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">trial_A</td>
<td align="right">8.0</td>
<td align="right">0.0</td>
<td align="right">3</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">trial_B</td>
<td align="right">0.0</td>
<td align="right">33.3</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">trial_B</td>
<td align="right">0.0</td>
<td align="right">50.0</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">trial_B</td>
<td align="right">0.0</td>
<td align="right">100.0</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">trial_B</td>
<td align="right">0.0</td>
<td align="right">200.0</td>
<td align="right">9</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">trial_B</td>
<td align="right">0.0</td>
<td align="right">400.0</td>
<td align="right">15</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">trial_B</td>
<td align="right">0.0</td>
<td align="right">800.0</td>
<td align="right">20</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">trial_B</td>
<td align="right">0.0</td>
<td align="right">1120.0</td>
<td align="right">17</td>
<td align="right">4</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>The objective is to aid dosing and dose-escalation decisions in a
future trial, <code>trial_AB</code>, in which the drugs will be
combined. Additionally, another investigator-initiated trial
<code>IIT</code> will study the same combination concurrently. Note that
these as-yet-unobserved sources of data are included in the input data
as unobserved factor levels. This mechanism allows us to specify a joint
meta-analytic prior for all four sources of historical and concurrent
data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">hist_combo2</span><span class="op">$</span><span class="va">group_id</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "trial_A"  "trial_B"  "IIT"      "trial_AB"</span></span></code></pre>
<p>However, we will first consider only the dual combination trial AB
and it’s historical data and add concurrent data at a later stage.</p>
<div class="section level3">
<h3 id="setting-up-the-trial-design">Setting up the trial design<a class="anchor" aria-label="anchor" href="#setting-up-the-trial-design"></a>
</h3>
<p>The function <code>blrm_trial</code> provides an object-oriented
framework for operationalizing the dose-escalation trial design. This
framework is intended as a convenient wrapper for the main model-fitting
engine of the package, the <code><a href="../reference/blrm_exnex.html">blrm_exnex()</a></code> function. The
latter allows additional flexibility for specifying the functional form
of the model, but <code>blrm_trial</code> covers the most common
use-cases. This introductory vignette highlights <code>blrm_trial</code>
in lieu of <code>blrm_exnex</code>; the reader is referred to the
help-page of the function<code><a href="../reference/blrm_exnex.html">?blrm_exnex</a></code> for more details.</p>
<p>One begins with <code>blrm_trial</code> by specifying three key
design elements:</p>
<ul>
<li>The historical dose-toxicity data</li>
<li>Information about the study drugs</li>
<li>The provisional dose levels to be studied during the escalation
trial</li>
</ul>
<p>Information about the study drugs is encoded through a
<code>tibble</code> as below. This includes the names of the
study-drugs, the reference doses (see [3] or <code><a href="../reference/blrm_exnex.html">?blrm_exnex</a></code> to
understand the role this choice plays in the model specification), the
dosing units, and (optionally) the a priori expected DLT rate for each
study drug given individually at the respective reference doses.</p>
<p>All design information for the study described in [1] is also
included as built-in datasets, which are part of the
<code>OncoBayes2</code> package.</p>
<div class="section level4">
<h4 id="drug-info">Drug info<a class="anchor" aria-label="anchor" href="#drug-info"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">kable</span><span class="op">(</span><span class="va">drug_info_combo2</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">drug_name</th>
<th align="right">dose_ref</th>
<th align="left">dose_unit</th>
<th align="right">reference_p_dlt</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">drug_A</td>
<td align="right">6</td>
<td align="left">mg</td>
<td align="right">0.2</td>
</tr>
<tr class="even">
<td align="left">drug_B</td>
<td align="right">1500</td>
<td align="left">mg</td>
<td align="right">0.2</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="dose-info">Dose info<a class="anchor" aria-label="anchor" href="#dose-info"></a>
</h4>
<p>The provisional dose levels are specified as below. For conciseness,
we limit the dose level of in these provisional doses.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dose_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">dose_info_combo2</span>, <span class="va">group_id</span> <span class="op">==</span> <span class="st">"trial_AB"</span>,</span>
<span>  <span class="va">drug_A</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">6</span><span class="op">)</span>, <span class="va">drug_B</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">400</span>, <span class="fl">800</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">dose_info</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">group_id</th>
<th align="right">drug_A</th>
<th align="right">drug_B</th>
<th align="right">dose_id</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">trial_AB</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">27</td>
</tr>
<tr class="even">
<td align="left">trial_AB</td>
<td align="right">3</td>
<td align="right">400</td>
<td align="right">28</td>
</tr>
<tr class="odd">
<td align="left">trial_AB</td>
<td align="right">3</td>
<td align="right">800</td>
<td align="right">30</td>
</tr>
<tr class="even">
<td align="left">trial_AB</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">35</td>
</tr>
<tr class="odd">
<td align="left">trial_AB</td>
<td align="right">6</td>
<td align="right">400</td>
<td align="right">36</td>
</tr>
<tr class="even">
<td align="left">trial_AB</td>
<td align="right">6</td>
<td align="right">800</td>
<td align="right">38</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="initializing-a-blrm_trial">Initializing a <code>blrm_trial</code><a class="anchor" aria-label="anchor" href="#initializing-a-blrm_trial"></a>
</h4>
<p>Together with the data described in the previous section, these
objects can be used to initialize a <code>blrm_trial</code> object.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combo2_trial_setup</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/blrm_trial.html">blrm_trial</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">hist_combo2</span>,</span>
<span>  drug_info <span class="op">=</span> <span class="va">drug_info_combo2</span>,</span>
<span>  dose_info <span class="op">=</span> <span class="va">dose_info</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## No stratum defined - assigning all groups to single stratum "all"</span></span></code></pre>
<pre><code><span><span class="co">## Please configure blrm_exnex using the update() function.</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="specifying-the-prior-and-fitting-the-model">Specifying the prior and fitting the model<a class="anchor" aria-label="anchor" href="#specifying-the-prior-and-fitting-the-model"></a>
</h3>
<p>At this point, the trial design has been initialized. However, in the
absence of <code>simplified_prior = TRUE</code>, we have not yet
specified the prior distribution for the dose-toxicity model.</p>
<p>OncoBayes2 provides two methods for completing the model
specification:</p>
<ol style="list-style-type: decimal">
<li><p>Use <code>simplified_prior = TRUE</code>, which employs a
package-default prior distribution, subject to a small number of
optional arguments controlling the details.</p></li>
<li><p>Provide a full prior specification to be passed to the
<code>blrm_exnex</code> function.</p></li>
</ol>
<p>For simplicity and conciseness purposes, here we use method #1, which
is not recommended for actual trials as the prior should be chosen
deliberately and there is no guarantee that the simplified prior will
remain stable across releases of the package. See
<code><a href="../reference/example-combo2_trial.html">?'example-combo2_trial'</a></code> for an example of #2. The below
choice of prior broadly follows the case study in [4], although we
slightly deviate from the model in [4] by a different reference dose and
mean reference DLT rate.</p>
<p>To employ the simplified prior, and fit the model with MCMC:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combo2_trial_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/blrm_trial.html">blrm_trial</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">hist_combo2</span>,</span>
<span>  drug_info <span class="op">=</span> <span class="va">drug_info_combo2</span>,</span>
<span>  dose_info <span class="op">=</span> <span class="va">dose_info</span>,</span>
<span>  simplified_prior <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  EXNEX_comp <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  EX_prob_comp_hist <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  EX_prob_comp_new <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in .blrm_trial_compute_simple_prior(object = trial, EXNEX_comp =</span></span>
<span><span class="co">## EXNEX_comp, : Simplified prior CAN and WILL change with releases. NOT</span></span>
<span><span class="co">## recommended to use in production. Instantiating a simplified prior - run</span></span>
<span><span class="co">## summary(trial, "blrm_exnex_call") to inspect arguments.</span></span></code></pre>
<pre><code><span><span class="co">## Warning: There were 1 divergent transitions after warmup. See</span></span>
<span><span class="co">## https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></span>
<span><span class="co">## to find out why this is a problem and how to eliminate them.</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Examine the pairs() plot to diagnose sampling problems</span></span></code></pre>
<pre><code><span><span class="co">## Warning: 1 out of 6 ewoc metrics are within the 95% MCMC error of the decision boundary.</span></span>
<span><span class="co">## Be careful when using the imprecise ewoc estimates! It is recommended to run</span></span>
<span><span class="co">## more iterations and review doses close to critical thresholds.</span></span>
<span><span class="co">## You may call "summary(trial, summarize='ewoc_check', ...)" for more diagnostic details.</span></span>
<span><span class="co">## Please call "help('blrm_trial', help_type='summary')" for further documentation.</span></span></code></pre>
<p>Now, the object <code>combo2_trial_start</code> contains the
posterior model fit at the start of the trial, in addition to the trial
design details. Next we highlight the main methods for extracting
relevant information from it.</p>
</div>
<div class="section level3">
<h3 id="summary-of-prior-specification">Summary of prior specification<a class="anchor" aria-label="anchor" href="#summary-of-prior-specification"></a>
</h3>
<p>The function <code>prior_summary</code> provides a facility for
printing, in a readable format, a summary of the prior
specification.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/prior_summary.blrmfit.html">prior_summary</a></span><span class="op">(</span><span class="va">combo2_trial_start</span><span class="op">)</span> <span class="co"># not run here</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="summary-of-posterior">Summary of posterior<a class="anchor" aria-label="anchor" href="#summary-of-posterior"></a>
</h3>
<p>The main target of inference is generally the probability of DLT at a
selection of provisional dose levels. To obtain these summaries for the
provisional doses specified previously, we simply write:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">combo2_trial_start</span>, <span class="st">"dose_prediction"</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="7%">
<col width="5%">
<col width="5%">
<col width="6%">
<col width="9%">
<col width="4%">
<col width="4%">
<col width="4%">
<col width="4%">
<col width="5%">
<col width="12%">
<col width="10%">
<col width="11%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left">group_id</th>
<th align="right">drug_A</th>
<th align="right">drug_B</th>
<th align="right">dose_id</th>
<th align="left">stratum_id</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">2.5%</th>
<th align="right">50%</th>
<th align="right">97.5%</th>
<th align="right">prob_underdose</th>
<th align="right">prob_target</th>
<th align="right">prob_overdose</th>
<th align="left">ewoc_ok</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">trial_AB</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">27</td>
<td align="left">all</td>
<td align="right">0.08</td>
<td align="right">0.14</td>
<td align="right">0.00</td>
<td align="right">0.04</td>
<td align="right">0.52</td>
<td align="right">0.88</td>
<td align="right">0.07</td>
<td align="right">0.04</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">trial_AB</td>
<td align="right">3</td>
<td align="right">400</td>
<td align="right">28</td>
<td align="left">all</td>
<td align="right">0.14</td>
<td align="right">0.17</td>
<td align="right">0.01</td>
<td align="right">0.09</td>
<td align="right">0.72</td>
<td align="right">0.74</td>
<td align="right">0.17</td>
<td align="right">0.09</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">trial_AB</td>
<td align="right">3</td>
<td align="right">800</td>
<td align="right">30</td>
<td align="left">all</td>
<td align="right">0.21</td>
<td align="right">0.20</td>
<td align="right">0.02</td>
<td align="right">0.15</td>
<td align="right">0.85</td>
<td align="right">0.53</td>
<td align="right">0.29</td>
<td align="right">0.18</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">trial_AB</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">35</td>
<td align="left">all</td>
<td align="right">0.18</td>
<td align="right">0.17</td>
<td align="right">0.01</td>
<td align="right">0.14</td>
<td align="right">0.77</td>
<td align="right">0.58</td>
<td align="right">0.29</td>
<td align="right">0.13</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">trial_AB</td>
<td align="right">6</td>
<td align="right">400</td>
<td align="right">36</td>
<td align="left">all</td>
<td align="right">0.24</td>
<td align="right">0.21</td>
<td align="right">0.02</td>
<td align="right">0.18</td>
<td align="right">0.91</td>
<td align="right">0.45</td>
<td align="right">0.31</td>
<td align="right">0.24</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">trial_AB</td>
<td align="right">6</td>
<td align="right">800</td>
<td align="right">38</td>
<td align="left">all</td>
<td align="right">0.32</td>
<td align="right">0.25</td>
<td align="right">0.02</td>
<td align="right">0.24</td>
<td align="right">0.94</td>
<td align="right">0.36</td>
<td align="right">0.26</td>
<td align="right">0.39</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
<p>Such summaries may be used to assess which combination doses have
unacceptable high risk of toxicity. For example, according to the
escalation with overdose control (EWOC) design criteria [3], one would
compute the posterior probability that each dose is excessively toxic
(column <code>prob_overdose</code>; note that the definition of
“excessively toxic” is encoded in the <code>blrm_trial</code> object
through the <code>interval_prob</code> argument), and take as eligible
doses only those where this probability does not exceed 25% (column
<code>ewoc_ok</code>).</p>
</div>
<div class="section level3">
<h3 id="posterior-accuracy-of-ewoc-estimation">Posterior accuracy of EWOC estimation<a class="anchor" aria-label="anchor" href="#posterior-accuracy-of-ewoc-estimation"></a>
</h3>
<p>Since the posterior is represented with a large sample of the target
density, any estimate derived from it is subject to finite sampling
error. The sampling error is determined by the posterior sample size and
the quality of the used Markov chain Monte Carlo (MCMC). Hence, it is
required to ensure that the MCMC chains have converged and that the
number of samples representing the posterior is large enough to estimate
desired quantities of interest with sufficient accuracy. The
<code>OncoBayes2</code> package automatically warns in case of
non-convergence as indicated by the Rhat diagnostic [5]. All model
parameters must have an Rhat of less than
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1.1</mn><annotation encoding="application/x-tex">1.1</annotation></semantics></math>
(values much larger than
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1.0</mn><annotation encoding="application/x-tex">1.0</annotation></semantics></math>
indicate non-convergence).</p>
<p>As the primary objective for a BLRM is to determine a safe set of
doses via estimation of EWOC, the key quantities defining EWOC are
monitored for convergence and sufficient accuracy for each pre-defined
dose as well. These diagnostics can be obtained for the pre-defined set
of doses via the <code>ewoc_check</code> summary routine as:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">combo2_trial_start</span>, <span class="st">"ewoc_check"</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: 1 out of 6 ewoc metrics are within the 95% MCMC error of the decision boundary.</span></span>
<span><span class="co">## Be careful when using the imprecise ewoc estimates! It is recommended to run</span></span>
<span><span class="co">## more iterations and review doses close to critical thresholds.</span></span>
<span><span class="co">## You may call "summary(trial, summarize='ewoc_check', ...)" for more diagnostic details.</span></span>
<span><span class="co">## Please call "help('blrm_trial', help_type='summary')" for further documentation.</span></span></code></pre>
<table style="width:100%;" class="table">
<colgroup>
<col width="6%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="8%">
<col width="13%">
<col width="14%">
<col width="14%">
<col width="13%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="left">group_id</th>
<th align="right">drug_A</th>
<th align="right">drug_B</th>
<th align="right">dose_id</th>
<th align="left">stratum_id</th>
<th align="right">prob_overdose_est</th>
<th align="right">prob_overdose_stat</th>
<th align="right">prob_overdose_mcse</th>
<th align="right">prob_overdose_ess</th>
<th align="right">prob_overdose_rhat</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">trial_AB</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">27</td>
<td align="left">all</td>
<td align="right">0.093</td>
<td align="right">-60.245</td>
<td align="right">0.004</td>
<td align="right">1898.087</td>
<td align="right">1.000</td>
</tr>
<tr class="even">
<td align="left">trial_AB</td>
<td align="right">3</td>
<td align="right">400</td>
<td align="right">28</td>
<td align="left">all</td>
<td align="right">0.164</td>
<td align="right">-41.309</td>
<td align="right">0.004</td>
<td align="right">1924.781</td>
<td align="right">1.001</td>
</tr>
<tr class="odd">
<td align="left">trial_AB</td>
<td align="right">3</td>
<td align="right">800</td>
<td align="right">30</td>
<td align="left">all</td>
<td align="right">0.275</td>
<td align="right">-8.714</td>
<td align="right">0.006</td>
<td align="right">1650.808</td>
<td align="right">1.000</td>
</tr>
<tr class="even">
<td align="left">trial_AB</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">35</td>
<td align="left">all</td>
<td align="right">0.230</td>
<td align="right">-17.027</td>
<td align="right">0.006</td>
<td align="right">2026.784</td>
<td align="right">1.002</td>
</tr>
<tr class="odd">
<td align="left">trial_AB</td>
<td align="right">6</td>
<td align="right">400</td>
<td align="right">36</td>
<td align="left">all</td>
<td align="right">0.322</td>
<td align="right">-1.165</td>
<td align="right">0.007</td>
<td align="right">1984.089</td>
<td align="right">1.002</td>
</tr>
<tr class="even">
<td align="left">trial_AB</td>
<td align="right">6</td>
<td align="right">800</td>
<td align="right">38</td>
<td align="left">all</td>
<td align="right">0.463</td>
<td align="right">13.750</td>
<td align="right">0.010</td>
<td align="right">2092.806</td>
<td align="right">1.002</td>
</tr>
</tbody>
</table>
<p>For the standard EWOC criterion, the <code>prob_overdose_est</code>
column contains the 75% quantile of the posterior DLT probability, which
must be smaller than 33%. The <code>prob_overdose_stat</code> column is
centered by 33% and standardized with the Monte-Carlo standard error
(mcse). Therefore, negative values correspond to safe doses and since
the quantity is approximately distributed as a standard normal random
variate, the statistic can be compared with quantiles of the standard
normal distribution. <code>OncoBayes2</code> will warn for an imprecise
EWOC estimate whenever the statistic is within the range of the central
95% interval of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><mn>1.96</mn><mo>,</mo><mn>1.96</mn><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(-1.96,1.96)</annotation></semantics></math>.
Whenever this occurs it can be useful to increase the number of
iterations in order to decrease the mcse, which scales with the inverse
of the square root of the MC ess. The MC ess is the number of
independent samples the posterior corresponds to (recall that MCMC
results in correlated samples). For more information please refer to the
help of the <code>summary.blrm_trial</code> function (see
<code><a href="../reference/blrm_trial.html">help("blrm_trial", help_type="summary")</a></code>).</p>
<p>We can see that for the pre-defined doses of the trial the EWOC
decision can be determined with more than enough accuracy given that the
statistic closest to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math>
is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>1.17</mn></mrow><annotation encoding="application/x-tex">-1.17</annotation></semantics></math>.</p>
</div>
<div class="section level3">
<h3 id="posterior-predictive-summaries">Posterior predictive summaries<a class="anchor" aria-label="anchor" href="#posterior-predictive-summaries"></a>
</h3>
<p>The BLRM allows a principled approach to predicting the number of
DLTs that may be observed in a future cohort. This may be a key estimand
for understanding and limiting the toxicity risk to patients. For
example, suppose a candidate starting dose for the new trial
<code>trial_AB</code> is 3 mg of drug A + 400 mg of drug B. We may wish
to check that at this dose, the predictive probability of 2 or more DLTs
out of an initial cohort of 3 to 6 patients is sufficiently low.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">candidate_starting_dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">combo2_trial_start</span>, <span class="st">"dose_info"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">drug_A</span> <span class="op">==</span> <span class="fl">3</span>, <span class="va">drug_B</span> <span class="op">==</span> <span class="fl">400</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span>num_toxicities <span class="op">=</span> <span class="fl">0</span>, num_patients <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pp_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">combo2_trial_start</span>,</span>
<span>  interval_prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">6</span><span class="op">)</span>, predictive <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  newdata <span class="op">=</span> <span class="va">candidate_starting_dose</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">candidate_starting_dose</span>, <span class="va">num_patients</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">pp_summary</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"]"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">num_patients</th>
<th align="right">(-1,0]</th>
<th align="right">(0,1]</th>
<th align="right">(1,6]</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">3</td>
<td align="right">0.696</td>
<td align="right">0.217</td>
<td align="right">0.087</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">0.636</td>
<td align="right">0.239</td>
<td align="right">0.125</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">0.586</td>
<td align="right">0.253</td>
<td align="right">0.162</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">0.542</td>
<td align="right">0.261</td>
<td align="right">0.197</td>
</tr>
</tbody>
</table>
<p>This tells us that for the initial cohort, according to the model,
the chance of two or more patients developing DLTs ranges from 8.7% to
19.7%, depending on the number of patients enrolled.</p>
</div>
<div class="section level3">
<h3 id="updating-the-model-with-new-data">Updating the model with new data<a class="anchor" aria-label="anchor" href="#updating-the-model-with-new-data"></a>
</h3>
<p>Dose-escalation designs are adaptive in nature, as dosing decisions
are made after each sequential cohort. The model must be updated with
the accrued data for each dose escalation decision point. If a new
cohort of patients is observed, say:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_cohort</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  group_id <span class="op">=</span> <span class="st">"trial_AB"</span>,</span>
<span>  drug_A <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  drug_B <span class="op">=</span> <span class="fl">400</span>,</span>
<span>  num_patients <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  num_toxicities <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>One can update the model to incorporate this new information using
<code><a href="https://rdrr.io/r/stats/update.html" class="external-link">update()</a></code> with <code>add_data</code> equal to the new
cohort:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combo2_trial_update</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">combo2_trial_start</span>, add_data <span class="op">=</span> <span class="va">new_cohort</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: 1 out of 6 ewoc metrics are within the 95% MCMC error of the decision boundary.</span></span>
<span><span class="co">## Be careful when using the imprecise ewoc estimates! It is recommended to run</span></span>
<span><span class="co">## more iterations and review doses close to critical thresholds.</span></span>
<span><span class="co">## You may call "summary(trial, summarize='ewoc_check', ...)" for more diagnostic details.</span></span>
<span><span class="co">## Please call "help('blrm_trial', help_type='summary')" for further documentation.</span></span></code></pre>
<p>This yields a new <code>blrm_trial</code> object with updated data
and posterior summaries. Obtaining the summaries for the pre-planned
provisional doses is then again straightforward:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">combo2_trial_update</span>, <span class="st">"dose_prediction"</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="7%">
<col width="5%">
<col width="5%">
<col width="6%">
<col width="9%">
<col width="4%">
<col width="4%">
<col width="4%">
<col width="4%">
<col width="5%">
<col width="12%">
<col width="10%">
<col width="11%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left">group_id</th>
<th align="right">drug_A</th>
<th align="right">drug_B</th>
<th align="right">dose_id</th>
<th align="left">stratum_id</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">2.5%</th>
<th align="right">50%</th>
<th align="right">97.5%</th>
<th align="right">prob_underdose</th>
<th align="right">prob_target</th>
<th align="right">prob_overdose</th>
<th align="left">ewoc_ok</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">trial_AB</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">27</td>
<td align="left">all</td>
<td align="right">0.08</td>
<td align="right">0.08</td>
<td align="right">0.00</td>
<td align="right">0.06</td>
<td align="right">0.27</td>
<td align="right">0.89</td>
<td align="right">0.10</td>
<td align="right">0.01</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">trial_AB</td>
<td align="right">3</td>
<td align="right">400</td>
<td align="right">28</td>
<td align="left">all</td>
<td align="right">0.14</td>
<td align="right">0.09</td>
<td align="right">0.02</td>
<td align="right">0.12</td>
<td align="right">0.37</td>
<td align="right">0.68</td>
<td align="right">0.27</td>
<td align="right">0.04</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">trial_AB</td>
<td align="right">3</td>
<td align="right">800</td>
<td align="right">30</td>
<td align="left">all</td>
<td align="right">0.23</td>
<td align="right">0.15</td>
<td align="right">0.04</td>
<td align="right">0.20</td>
<td align="right">0.58</td>
<td align="right">0.38</td>
<td align="right">0.40</td>
<td align="right">0.22</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">trial_AB</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">35</td>
<td align="left">all</td>
<td align="right">0.18</td>
<td align="right">0.13</td>
<td align="right">0.01</td>
<td align="right">0.15</td>
<td align="right">0.49</td>
<td align="right">0.53</td>
<td align="right">0.37</td>
<td align="right">0.10</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">trial_AB</td>
<td align="right">6</td>
<td align="right">400</td>
<td align="right">36</td>
<td align="left">all</td>
<td align="right">0.25</td>
<td align="right">0.16</td>
<td align="right">0.04</td>
<td align="right">0.22</td>
<td align="right">0.61</td>
<td align="right">0.34</td>
<td align="right">0.39</td>
<td align="right">0.27</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">trial_AB</td>
<td align="right">6</td>
<td align="right">800</td>
<td align="right">38</td>
<td align="left">all</td>
<td align="right">0.34</td>
<td align="right">0.22</td>
<td align="right">0.04</td>
<td align="right">0.30</td>
<td align="right">0.82</td>
<td align="right">0.25</td>
<td align="right">0.30</td>
<td align="right">0.46</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
<p>In case posterior summaries are needed for doses other than the
pre-planned ones, then this is possible using the
<code>newdata_prediction</code> functionality, which allows to specify a
different set of doses via the <code>newdata</code> argument:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">combo2_trial_update</span>, <span class="st">"newdata_prediction"</span>,</span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    group_id <span class="op">=</span> <span class="st">"trial_AB"</span>,</span>
<span>    drug_A <span class="op">=</span> <span class="fl">4.5</span>,</span>
<span>    drug_B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">400</span>, <span class="fl">600</span>, <span class="fl">800</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## stratum_id not given, but only one stratum defined. Assigning first stratum.</span></span></code></pre>
<table style="width:100%;" class="table">
<colgroup>
<col width="7%">
<col width="5%">
<col width="5%">
<col width="9%">
<col width="6%">
<col width="4%">
<col width="4%">
<col width="4%">
<col width="4%">
<col width="5%">
<col width="12%">
<col width="10%">
<col width="11%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left">group_id</th>
<th align="right">drug_A</th>
<th align="right">drug_B</th>
<th align="left">stratum_id</th>
<th align="right">dose_id</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">2.5%</th>
<th align="right">50%</th>
<th align="right">97.5%</th>
<th align="right">prob_underdose</th>
<th align="right">prob_target</th>
<th align="right">prob_overdose</th>
<th align="left">ewoc_ok</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">trial_AB</td>
<td align="right">4.5</td>
<td align="right">400</td>
<td align="left">all</td>
<td align="right">NA</td>
<td align="right">0.19</td>
<td align="right">0.12</td>
<td align="right">0.03</td>
<td align="right">0.16</td>
<td align="right">0.48</td>
<td align="right">0.49</td>
<td align="right">0.38</td>
<td align="right">0.13</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">trial_AB</td>
<td align="right">4.5</td>
<td align="right">600</td>
<td align="left">all</td>
<td align="right">NA</td>
<td align="right">0.23</td>
<td align="right">0.15</td>
<td align="right">0.04</td>
<td align="right">0.20</td>
<td align="right">0.59</td>
<td align="right">0.38</td>
<td align="right">0.38</td>
<td align="right">0.24</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">trial_AB</td>
<td align="right">4.5</td>
<td align="right">800</td>
<td align="left">all</td>
<td align="right">NA</td>
<td align="right">0.28</td>
<td align="right">0.18</td>
<td align="right">0.04</td>
<td align="right">0.24</td>
<td align="right">0.71</td>
<td align="right">0.29</td>
<td align="right">0.37</td>
<td align="right">0.34</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="data-scenarios">Data scenarios<a class="anchor" aria-label="anchor" href="#data-scenarios"></a>
</h3>
<p>It may be of interest to test prospectively how this model responds
in various scenarios for upcoming cohorts.</p>
<p>This can be done easily by again using <code><a href="https://rdrr.io/r/stats/update.html" class="external-link">update()</a></code> with the
<code>add_data</code> argument. In the code below, we explore 3 possible
outcomes for a subsequent cohort enrolled at 3 mg drug A + 800 mg drug
B, and review the model’s inference at adjacent doses.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set up two scenarios at the starting dose level</span></span>
<span><span class="co"># store them as data frames in a named list</span></span>
<span><span class="va">scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html" class="external-link">expand_grid</a></span><span class="op">(</span></span>
<span>  group_id <span class="op">=</span> <span class="st">"trial_AB"</span>,</span>
<span>  drug_A <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  drug_B <span class="op">=</span> <span class="fl">800</span>,</span>
<span>  num_patients <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  num_toxicities <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">2</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">2</span>, <span class="st">"/3 DLTs"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">candidate_doses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html" class="external-link">expand_grid</a></span><span class="op">(</span></span>
<span>  group_id <span class="op">=</span> <span class="st">"trial_AB"</span>,</span>
<span>  drug_A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4.5</span><span class="op">)</span>,</span>
<span>  drug_B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">600</span>, <span class="fl">800</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">scenario_inference</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">scenarios</span>, <span class="kw">function</span><span class="op">(</span><span class="va">scenario_newdata</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># refit the model with each scenario's additional data</span></span>
<span>  <span class="va">scenario_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">combo2_trial_update</span>, add_data <span class="op">=</span> <span class="va">scenario_newdata</span><span class="op">)</span></span>
<span>  <span class="co"># summarize posterior at candidate doses</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">scenario_fit</span>, <span class="st">"newdata_prediction"</span>, newdata <span class="op">=</span> <span class="va">candidate_doses</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"Scenario"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: There were 1 divergent transitions after warmup. See</span></span>
<span><span class="co">## https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></span>
<span><span class="co">## to find out why this is a problem and how to eliminate them.</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Examine the pairs() plot to diagnose sampling problems</span></span></code></pre>
<pre><code><span><span class="co">## Warning: 1 out of 6 ewoc metrics are within the 95% MCMC error of the decision boundary.</span></span>
<span><span class="co">## Be careful when using the imprecise ewoc estimates! It is recommended to run</span></span>
<span><span class="co">## more iterations and review doses close to critical thresholds.</span></span>
<span><span class="co">## You may call "summary(trial, summarize='ewoc_check', ...)" for more diagnostic details.</span></span>
<span><span class="co">## Please call "help('blrm_trial', help_type='summary')" for further documentation.</span></span></code></pre>
<table style="width:100%;" class="table">
<caption>Model inference for trial AB when varying hypothetical DLT
scenarios for a cohort of size 3</caption>
<colgroup>
<col width="9%">
<col width="7%">
<col width="7%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="6%">
<col width="15%">
<col width="12%">
<col width="14%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="left">Scenario</th>
<th align="right">drug_A</th>
<th align="right">drug_B</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">2.5%</th>
<th align="right">50%</th>
<th align="right">97.5%</th>
<th align="right">prob_underdose</th>
<th align="right">prob_target</th>
<th align="right">prob_overdose</th>
<th align="left">ewoc_ok</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0/3 DLTs</td>
<td align="right">3.0</td>
<td align="right">600</td>
<td align="right">0.13</td>
<td align="right">0.08</td>
<td align="right">0.02</td>
<td align="right">0.12</td>
<td align="right">0.34</td>
<td align="right">0.70</td>
<td align="right">0.27</td>
<td align="right">0.03</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">0/3 DLTs</td>
<td align="right">3.0</td>
<td align="right">800</td>
<td align="right">0.17</td>
<td align="right">0.10</td>
<td align="right">0.03</td>
<td align="right">0.15</td>
<td align="right">0.42</td>
<td align="right">0.55</td>
<td align="right">0.37</td>
<td align="right">0.08</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">0/3 DLTs</td>
<td align="right">4.5</td>
<td align="right">600</td>
<td align="right">0.17</td>
<td align="right">0.11</td>
<td align="right">0.03</td>
<td align="right">0.15</td>
<td align="right">0.45</td>
<td align="right">0.53</td>
<td align="right">0.37</td>
<td align="right">0.10</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">0/3 DLTs</td>
<td align="right">4.5</td>
<td align="right">800</td>
<td align="right">0.21</td>
<td align="right">0.14</td>
<td align="right">0.03</td>
<td align="right">0.18</td>
<td align="right">0.56</td>
<td align="right">0.44</td>
<td align="right">0.39</td>
<td align="right">0.17</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">1/3 DLTs</td>
<td align="right">3.0</td>
<td align="right">600</td>
<td align="right">0.20</td>
<td align="right">0.10</td>
<td align="right">0.05</td>
<td align="right">0.18</td>
<td align="right">0.44</td>
<td align="right">0.42</td>
<td align="right">0.47</td>
<td align="right">0.11</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">1/3 DLTs</td>
<td align="right">3.0</td>
<td align="right">800</td>
<td align="right">0.25</td>
<td align="right">0.13</td>
<td align="right">0.06</td>
<td align="right">0.23</td>
<td align="right">0.55</td>
<td align="right">0.26</td>
<td align="right">0.50</td>
<td align="right">0.24</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">1/3 DLTs</td>
<td align="right">4.5</td>
<td align="right">600</td>
<td align="right">0.26</td>
<td align="right">0.14</td>
<td align="right">0.06</td>
<td align="right">0.24</td>
<td align="right">0.59</td>
<td align="right">0.27</td>
<td align="right">0.46</td>
<td align="right">0.28</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">1/3 DLTs</td>
<td align="right">4.5</td>
<td align="right">800</td>
<td align="right">0.32</td>
<td align="right">0.17</td>
<td align="right">0.07</td>
<td align="right">0.29</td>
<td align="right">0.69</td>
<td align="right">0.19</td>
<td align="right">0.38</td>
<td align="right">0.43</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">2/3 DLTs</td>
<td align="right">3.0</td>
<td align="right">600</td>
<td align="right">0.28</td>
<td align="right">0.13</td>
<td align="right">0.08</td>
<td align="right">0.26</td>
<td align="right">0.60</td>
<td align="right">0.19</td>
<td align="right">0.50</td>
<td align="right">0.31</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">2/3 DLTs</td>
<td align="right">3.0</td>
<td align="right">800</td>
<td align="right">0.36</td>
<td align="right">0.16</td>
<td align="right">0.11</td>
<td align="right">0.34</td>
<td align="right">0.73</td>
<td align="right">0.08</td>
<td align="right">0.40</td>
<td align="right">0.52</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">2/3 DLTs</td>
<td align="right">4.5</td>
<td align="right">600</td>
<td align="right">0.36</td>
<td align="right">0.16</td>
<td align="right">0.10</td>
<td align="right">0.34</td>
<td align="right">0.72</td>
<td align="right">0.10</td>
<td align="right">0.38</td>
<td align="right">0.53</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">2/3 DLTs</td>
<td align="right">4.5</td>
<td align="right">800</td>
<td align="right">0.44</td>
<td align="right">0.19</td>
<td align="right">0.12</td>
<td align="right">0.43</td>
<td align="right">0.82</td>
<td align="right">0.06</td>
<td align="right">0.26</td>
<td align="right">0.68</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="continuation-of-example-using-concurrent-data">Continuation of example: Using concurrent data<a class="anchor" aria-label="anchor" href="#continuation-of-example-using-concurrent-data"></a>
</h2>
<p>In the example of [1], at the time of completion of the first stage
of <code>trial_AB</code>, the following additional data was
observed.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trial_AB_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">codata_combo2</span>, <span class="va">group_id</span> <span class="op">==</span> <span class="st">"trial_AB"</span>, <span class="va">cohort_time</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">trial_AB_data</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">group_id</th>
<th align="right">drug_A</th>
<th align="right">drug_B</th>
<th align="right">num_patients</th>
<th align="right">num_toxicities</th>
<th align="right">cohort_time</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">trial_AB</td>
<td align="right">3</td>
<td align="right">400</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">trial_AB</td>
<td align="right">3</td>
<td align="right">800</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">trial_AB</td>
<td align="right">6</td>
<td align="right">400</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>These data are easily incorporated into the model using another call
to <code>update</code>, as below.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combo2_trial_histdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">combo2_trial_start</span>, add_data <span class="op">=</span> <span class="va">trial_AB_data</span><span class="op">)</span></span></code></pre></div>
<p>However, during the first stage of <code>trial_AB</code>, the
<code>trial_A</code> studying drug A did continue and collected more
data on the drug A dose-toxicity relationship:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trial_A_codata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">codata_combo2</span>, <span class="va">group_id</span> <span class="op">==</span> <span class="st">"trial_A"</span>, <span class="va">cohort_time</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">trial_A_codata</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">group_id</th>
<th align="right">drug_A</th>
<th align="right">drug_B</th>
<th align="right">num_patients</th>
<th align="right">num_toxicities</th>
<th align="right">cohort_time</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">trial_A</td>
<td align="right">3.0</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">trial_A</td>
<td align="right">4.5</td>
<td align="right">0</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">trial_A</td>
<td align="right">6.0</td>
<td align="right">0</td>
<td align="right">11</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">trial_A</td>
<td align="right">8.0</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Wthin the MAC framework we may simply add the concurrent data to our
overall model which yields refined predictions for future cohorts.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combo2_trial_codata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">combo2_trial_histdata</span>, add_data <span class="op">=</span> <span class="va">trial_A_codata</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in .blrm_trial_sanitize_data(trial = trial, data = args[["add_data"]]):</span></span>
<span><span class="co">## Data that was provided does not correspond to a pre-specified dose!</span></span></code></pre>
<p>To compare the effect of co-data in this case it is simplest to
visualize the interval probabilities as predicted by the model for the
different data constellations. Here we use the function
<code>plot_toxicity_intervals_stacked</code> to explore the
dose-toxicity relationship in a continuous manner in terms of the
dose.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_blrm.html">plot_toxicity_intervals_stacked</a></span><span class="op">(</span><span class="va">combo2_trial_histdata</span>,</span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">dose_info</span>, dose_id <span class="op">=</span> <span class="cn">NULL</span>, stratum_id <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span>,</span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">drug_B</span><span class="op">)</span>,</span>
<span>  group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">drug_A</span><span class="op">)</span>,</span>
<span>  facet_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Trial AB with historical data only"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-25-1.png" width="622.08"></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_blrm.html">plot_toxicity_intervals_stacked</a></span><span class="op">(</span><span class="va">combo2_trial_codata</span>,</span>
<span>  newdata <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">dose_info</span>, dose_id <span class="op">=</span> <span class="cn">NULL</span>, stratum_id <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span>,</span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">drug_B</span><span class="op">)</span>,</span>
<span>  group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">drug_A</span><span class="op">)</span>,</span>
<span>  facet_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Trial AB with historical and concurrent data on drug A"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-25-2.png" width="622.08"></p>
<p>As we can observe, the additional data on drug A moves the maximal
admissible dose allowed by EWOC towards higher doses for drug B whenever
drug A is 6 mg. This reflects that drug A has been observed to be
relatively safe, since no DLT was observed for a number of doses.</p>
<p>In the example of [1], during the conduct of the second stage of the
<code>trial_AB</code> an additional external data source from a new
trial became available. This time it is stemming from another trial
which is an investigator-initiated trial <code>IIT</code> of the same
combination. Numerous toxicities were observed in this concurrent study
as stage 2 of <code>trial_AB</code>.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trial_AB_stage_2_codata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">codata_combo2</span>, <span class="va">cohort_time</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">trial_AB_stage_2_codata</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">group_id</th>
<th align="right">drug_A</th>
<th align="right">drug_B</th>
<th align="right">num_patients</th>
<th align="right">num_toxicities</th>
<th align="right">cohort_time</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">IIT</td>
<td align="right">3.0</td>
<td align="right">400</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">IIT</td>
<td align="right">3.0</td>
<td align="right">800</td>
<td align="right">7</td>
<td align="right">5</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">IIT</td>
<td align="right">4.5</td>
<td align="right">400</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">IIT</td>
<td align="right">6.0</td>
<td align="right">400</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">IIT</td>
<td align="right">6.0</td>
<td align="right">600</td>
<td align="right">3</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">trial_AB</td>
<td align="right">3.0</td>
<td align="right">400</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">trial_AB</td>
<td align="right">3.0</td>
<td align="right">800</td>
<td align="right">6</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">trial_AB</td>
<td align="right">4.5</td>
<td align="right">600</td>
<td align="right">10</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">trial_AB</td>
<td align="right">6.0</td>
<td align="right">400</td>
<td align="right">10</td>
<td align="right">3</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<p>As before, through the MAC framework, these data can influence the
model summaries for <code>trial_AB</code>. We leave it to the reader to
explore the differences in the co-data (combined historical and
concurrent data) vs the historical data only approach.</p>
<p>To conclude we present a graphical summary of the dose-toxicity
relationship for the dual combination trial for the final data
constellation. Note that we use the <code>data</code> option of
<code>update</code> here to ensure that we use an entirely new dataset
which includes all data collected; so this includes historical, trial
and concurrent data:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combo2_trial_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">combo2_trial_start</span>, data <span class="op">=</span> <span class="va">codata_combo2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in .blrm_trial_sanitize_data(trial = trial, data = args[["data"]]):</span></span>
<span><span class="co">## Data that was provided does not correspond to a pre-specified dose!</span></span></code></pre>
<pre><code><span><span class="co">## Warning: There were 2 divergent transitions after warmup. See</span></span>
<span><span class="co">## https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></span>
<span><span class="co">## to find out why this is a problem and how to eliminate them.</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Examine the pairs() plot to diagnose sampling problems</span></span></code></pre>
<p>As final summary we consider the 75% quantile of the probability for
a DLT at all dose combinations. Whenever the 75% quantile exceeds 33%,
then the EWOC criterion is violated and the dose is too toxic.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid_length</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span></span>
<span><span class="va">dose_info_plot_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html" class="external-link">expand_grid</a></span><span class="op">(</span></span>
<span>  stratum_id <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  group_id <span class="op">=</span> <span class="st">"trial_AB"</span>,</span>
<span>  drug_A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">dose_info_combo2</span><span class="op">$</span><span class="va">drug_A</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dose_info_combo2</span><span class="op">$</span><span class="va">drug_A</span><span class="op">)</span>,</span>
<span>               length.out <span class="op">=</span> <span class="va">grid_length</span><span class="op">)</span>,</span>
<span>  drug_B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">dose_info_combo2</span><span class="op">$</span><span class="va">drug_B</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dose_info_combo2</span><span class="op">$</span><span class="va">drug_B</span><span class="op">)</span>,</span>
<span>               length.out <span class="op">=</span> <span class="va">grid_length</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">dose_info_plot_grid_sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">combo2_trial_final</span>,</span>
<span>  newdata <span class="op">=</span> <span class="va">dose_info_plot_grid</span>,</span>
<span>  prob <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dose_info_plot_grid_sum</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">drug_A</span>, <span class="va">drug_B</span>, z <span class="op">=</span> <span class="op">!</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/name.html" class="external-link">as.name</a></span><span class="op">(</span><span class="st">"75%"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html" class="external-link">geom_contour_filled</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.16</span>, <span class="fl">0.33</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span><span class="st">"Quantile Range"</span>, type <span class="op">=</span> <span class="st">"div"</span>, palette <span class="op">=</span> <span class="st">"RdBu"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"DLT Probability 75% Quantile"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-28-1.png" width="622.08"></p>
<!---
## Advanced topics

### Grouping and stratification factors

A brief note on terminology: the `group_id` variable, present in the `data`
and `dose_info` arguments of a `blrm_trial` object, divides observations and
dose levels into homogeneous groups sharing the same set of parameters
in the hierarchical model. These `group_id`'s are referred to as "strata"
in [1], [2], and [4]. No confusion should arise between this terminology
and the `stratum_id` variable, an optional set of higher-level stratifying
factors which can serve to divide the `group_id`'s into classes which 
share the same heterogeneity parameters. For more information on models
employing multiple `stratum_id`'s, the user is referred to the
section of `?blrm_exnex` on differential discounting, and to 
`?example-combo3` for an example.
-->
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>[1] Neuenschwander, B., Roychoudhury, S., &amp; Schmidli, H. (2016).
On the use of co-data in clinical trials. Statistics in
Biopharmaceutical Research, 8(3), 345-354.</p>
<p>[2] Neuenschwander, B., Wandel, S., Roychoudhury, S., &amp; Bailey,
S. (2016). Robust exchangeability designs for early phase clinical
trials with multiple strata. Pharmaceutical statistics, 15(2),
123-134.</p>
<p>[3] Neuenschwander, B., Branson, M., &amp; Gsponer, T. (2008).
Critical aspects of the Bayesian approach to phase I cancer trials.
Statistics in medicine, 27(13), 2420-2439.</p>
<p>[4] Neuenschwander, B., Matano, A., Tang, Z., Roychoudhury, S.,
Wandel, S. Bailey, Stuart. (2014). A Bayesian Industry Approach to Phase
I Combination Trials in Oncology. In Statistical methods in drug
combination studies (Vol. 69). CRC Press.</p>
<p>[5] Vehtari, A., Gelman, A., Simpson, D., Carpenter, B., Bürkner, P.
C. (2021). Rank-Normalization, Folding, and Localization: An Improved
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>R</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{R}</annotation></semantics></math>)
for Assessing Convergence of MCMC, Bayesian Analysis, 16 (2), 667–718.
<a href="https://doi.org/10.1214/20-BA1221" class="external-link uri">https://doi.org/10.1214/20-BA1221</a></p>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.5.1 (2025-06-13)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">## Running under: Ubuntu 24.04.3 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] tibble_3.3.0     ggplot2_4.0.0    knitr_1.50       tidyr_1.3.1     </span></span>
<span><span class="co">## [5] dplyr_1.1.4      posterior_1.6.1  OncoBayes2_0.9-4 RBesT_1.8-2     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] tensorA_0.36.2.1      sass_0.4.10           generics_0.1.4       </span></span>
<span><span class="co">##  [4] digest_0.6.37         magrittr_2.0.4        evaluate_1.0.5       </span></span>
<span><span class="co">##  [7] grid_4.5.1            RColorBrewer_1.1-3    mvtnorm_1.3-3        </span></span>
<span><span class="co">## [10] fastmap_1.2.0         jsonlite_2.0.0        pkgbuild_1.4.8       </span></span>
<span><span class="co">## [13] backports_1.5.0       Formula_1.2-5         gridExtra_2.3        </span></span>
<span><span class="co">## [16] purrr_1.1.0           QuickJSR_1.8.1        scales_1.4.0         </span></span>
<span><span class="co">## [19] isoband_0.2.7         codetools_0.2-20      textshaping_1.0.4    </span></span>
<span><span class="co">## [22] jquerylib_0.1.4       abind_1.4-8           cli_3.6.5            </span></span>
<span><span class="co">## [25] rlang_1.1.6           withr_3.0.2           cachem_1.1.0         </span></span>
<span><span class="co">## [28] yaml_2.3.10           StanHeaders_2.32.10   parallel_4.5.1       </span></span>
<span><span class="co">## [31] tools_4.5.1           rstan_2.32.7          inline_0.3.21        </span></span>
<span><span class="co">## [34] rstantools_2.5.0      checkmate_2.3.3       assertthat_0.2.1     </span></span>
<span><span class="co">## [37] vctrs_0.6.5           R6_2.6.1              matrixStats_1.5.0    </span></span>
<span><span class="co">## [40] stats4_4.5.1          lifecycle_1.0.4       fs_1.6.6             </span></span>
<span><span class="co">## [43] ragg_1.5.0            pkgconfig_2.0.3       desc_1.4.3           </span></span>
<span><span class="co">## [46] pkgdown_2.1.3         RcppParallel_5.1.11-1 pillar_1.11.1        </span></span>
<span><span class="co">## [49] bslib_0.9.0           gtable_0.3.6          loo_2.8.0            </span></span>
<span><span class="co">## [52] glue_1.8.0            Rcpp_1.1.0            systemfonts_1.3.1    </span></span>
<span><span class="co">## [55] xfun_0.53             tidyselect_1.2.1      bayesplot_1.14.0     </span></span>
<span><span class="co">## [58] farver_2.1.2          htmltools_0.5.8.1     labeling_0.4.3       </span></span>
<span><span class="co">## [61] rmarkdown_2.30        compiler_4.5.1        S7_0.2.0             </span></span>
<span><span class="co">## [64] distributional_0.5.0</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sebastian Weber, Lukas A. Widmer, Andrew Bean.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
